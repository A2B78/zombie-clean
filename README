## **üì¶ Installation & D√©ploiement**

### **Installation Rapide (recommand√©)**
```bash
# Clonez le d√©p√¥t
git clone https://github.com/votre-username/zombie-process-monitor.git
cd zombie-process-monitor

# Installation compl√®te
sudo ./install.sh

# Le script vous guidera √† travers les options:
# - Fr√©quence de surveillance (quotidienne/hebdomadaire/etc.)
# - Installation systemd (optionnel)
# - Configuration des alias
```

### **Installation Manuellement**
```bash
# Copier le script
sudo cp zombie_monitor.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/zombie_monitor.sh

# Configurer la surveillance quotidienne
sudo zombie_monitor.sh --install-cron
```

### **Mise √† Jour**
```bash
cd zombie-process-monitor
git pull origin main
sudo ./install.sh
```

### **D√©sinstallation**
```bash
sudo ./uninstall.sh
```

## **üìÇ Structure du Projet Compl√®te**
```
zombie-process-monitor/
‚îú‚îÄ‚îÄ zombie_monitor.sh          # Script principal
‚îú‚îÄ‚îÄ install.sh                 # Script d'installation automatis√©e
‚îú‚îÄ‚îÄ uninstall.sh              # Script de d√©sinstallation propre
‚îú‚îÄ‚îÄ CHANGELOG.md              # Historique des versions
‚îú‚îÄ‚îÄ LICENSE                   # Licence MIT
‚îú‚îÄ‚îÄ systemd/                  # Int√©gration systemd (optionnel)
‚îÇ   ‚îú‚îÄ‚îÄ zombie-monitor.service
‚îÇ   ‚îî‚îÄ‚îÄ zombie-monitor.timer
‚îú‚îÄ‚îÄ examples/                 # Exemples de configuration
‚îÇ   ‚îú‚îÄ‚îÄ cron_example         # Exemples de t√¢ches cron
‚îÇ   ‚îú‚îÄ‚îÄ alert_config         # Configuration des alertes
‚îÇ   ‚îî‚îÄ‚îÄ email_template       # Template d'email d'alerte
‚îî‚îÄ‚îÄ tests/                   # Tests automatis√©s (√† venir)
    ‚îú‚îÄ‚îÄ test_zombies.sh
    ‚îî‚îÄ‚îÄ integration_tests.sh
```

### **Options d'Installation**
Le script d'installation propose plusieurs options :
1. **Fr√©quence de surveillance** (quotidienne, horaire, manuelle)
2. **Int√©gration systemd** pour un meilleur contr√¥le
3. **Alias Bash** pour une utilisation simplifi√©e
4. **Configuration de la journalisation**

### **V√©rification de l'Installation**
```bash
# V√©rifier que l'installation a r√©ussi
which zombie-monitor
zombie-check

# V√©rifier les t√¢ches cron
crontab -l

# V√©rifier les logs
tail -f /var/log/zombie_monitor.log
```

## **4. Cr√©ez les dossiers manquants**

```bash
# Structure compl√®te
mkdir -p systemd examples tests

# Fichier de service systemd
cat > systemd/zombie-monitor.service << 'EOF'
[Unit]
Description=Zombie Process Monitor
After=network.target
Documentation=https://github.com/A2B78/zombie-clean

[Service]
Type=oneshot
ExecStart=/usr/local/bin/zombie_monitor.sh --check
User=root
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

cat > systemd/zombie-monitor.timer << 'EOF'
[Unit]
Description=Daily Zombie Process Check
Requires=zombie-monitor.service

[Timer]
OnCalendar=daily
Persistent=true
RandomizedDelaySec=300

[Install]
WantedBy=timers.target
EOF

# Fichiers d'exemple
cat > examples/cron_example << 'EOF'
# Exemples de configuration cron pour Zombie Monitor

# Tous les jours √† 2h du matin
0 2 * * * /usr/local/bin/zombie_monitor.sh --check >> /var/log/zombie_monitor.log 2>&1

# Toutes les 6 heures
0 */6 * * * /usr/local/bin/zombie_monitor.sh --check >> /var/log/zombie_monitor.log 2>&1

# Toutes les heures (pour les environnements critiques)
0 * * * * /usr/local/bin/zombie_monitor.sh --check >> /var/log/zombie_monitor.log 2>&1

# Tous les lundis √† 3h
0 3 * * 1 /usr/local/bin/zombie_monitor.sh --check >> /var/log/zombie_monitor.log 2>&1
EOF

cat > examples/alert_config << 'EOF'
# Configuration des alertes pour Zombie Monitor
# Copier ce fichier vers /etc/zombie_monitor/alert.conf

# Email pour les alertes
ALERT_EMAIL="admin@example.com"

# Seuil d'alerte (nombre de zombies)
CRITICAL_THRESHOLD=10
WARNING_THRESHOLD=5

# Fr√©quence des alertes (en minutes)
ALERT_COOLDOWN=60

# Activer les notifications syst√®me
ENABLE_SYSTEM_NOTIFICATIONS=true

# Activer les emails
ENABLE_EMAIL_ALERTS=false

# Activer les logs d√©taill√©s
VERBOSE_LOGGING=true
EOF
```

## **5. Rendez les scripts ex√©cutables**

```bash
chmod +x install.sh uninstall.sh zombie_monitor.sh
```

Maintenant vous avez un syst√®me complet d'installation et de gestion pour votre outil de surveillance des processus zombies !


---

Voici un script Bash pour surveiller les processus zombies avec v√©rification quotidienne :

## **Script de surveillance des zombies** (`zombie_monitor.sh`)

```bash
#!/bin/bash

# zombie_monitor.sh - Surveillance des processus zombies
# Usage: ./zombie_monitor.sh [--check] [--clean] [--install-cron]

LOG_FILE="/var/log/zombie_monitor.log"
MAX_ZOMBIES=5
ALERT_EMAIL=""  # Mettez votre email ici si vous voulez des alertes

# Couleurs pour l'affichage
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Fonction de journalisation
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Fonction pour v√©rifier les zombies
check_zombies() {
    local zombie_count=$(ps aux | awk '$8=="Z" || $8=="Z+"' | grep -v "USER" | wc -l)
    
    if [ $zombie_count -gt 0 ]; then
        log_message "${RED}‚ö†Ô∏è  ALERTE: $zombie_count processus zombie(s) d√©tect√©(s)!${NC}"
        
        # Afficher les d√©tails des zombies
        log_message "${YELLOW}D√©tails des processus zombies:${NC}"
        ps aux | awk '$8=="Z" || $8=="Z+"' | tee -a "$LOG_FILE"
        
        # Afficher les processus parents
        log_message "${YELLOW}Processus parents potentiels:${NC}"
        ps -eo pid,ppid,stat,comm | awk '$3=="Z" || $3=="Z+"' | tee -a "$LOG_FILE"
        
        # V√©rifier si le nombre d√©passe le seuil
        if [ $zombie_count -ge $MAX_ZOMBIES ]; then
            log_message "${RED}üö® SEUIL D√âPASS√â: Plus de $MAX_ZOMBIES zombies! Action recommand√©e.${NC}"
            return 2
        fi
        return 1
    else
        log_message "${GREEN}‚úÖ Aucun processus zombie d√©tect√©.${NC}"
        return 0
    fi
}

# Fonction pour nettoyer les zombies
clean_zombies() {
    log_message "${YELLOW}Tentative de nettoyage des zombies...${NC}"
    
    # M√©thode 1: Tuer les processus parents
    local parent_pids=$(ps -eo pid,ppid,stat | awk '$3=="Z" || $3=="Z+" {print $2}' | sort -u)
    
    for pid in $parent_pids; do
        if [ $pid -gt 1 ]; then  # Ne pas tuer init (PID 1)
            log_message "Envoi SIGCHLD au processus parent PID: $pid"
            kill -s SIGCHLD $pid 2>/dev/null
        fi
    done
    
    # Attendre un peu
    sleep 2
    
    # V√©rifier si des zombies restent
    local remaining_zombies=$(ps aux | awk '$8=="Z" || $8=="Z+"' | grep -v "USER" | wc -l)
    
    if [ $remaining_zombies -gt 0 ]; then
        log_message "${YELLOW}Il reste $remaining_zombies zombie(s).${NC}"
        
        # M√©thode 2: Reboot si trop de zombies
        if [ $remaining_zombies -ge 10 ]; then
            log_message "${RED}Beaucoup de zombies restants. Un red√©marrage est recommand√©.${NC}"
            read -p "Voulez-vous red√©marrer le syst√®me? (o/n): " -n 1 -r
            echo
            if [[ $REPLY =~ ^[Oo]$ ]]; then
                log_message "Red√©marrage du syst√®me..."
                sudo reboot
            fi
        fi
    else
        log_message "${GREEN}‚úÖ Tous les zombies ont √©t√© nettoy√©s!${NC}"
    fi
}

# Fonction pour installer la t√¢che cron
install_cron_job() {
    local script_path="$(realpath "$0")"
    
    log_message "Installation de la t√¢che cron quotidienne..."
    
    # Cr√©er une t√¢che cron pour ex√©cuter le script tous les jours √† 2h du matin
    (crontab -l 2>/dev/null | grep -v "$script_path"; echo "0 2 * * * $script_path --check >> $LOG_FILE 2>&1") | crontab -
    
    # Ajouter aussi une v√©rification toutes les heures si vous voulez
    # (crontab -l 2>/dev/null | grep -v "$script_path"; echo "0 * * * * $script_path --check >> /tmp/zombie_check.log 2>&1") | crontab -
    
    log_message "${GREEN}‚úÖ T√¢che cron install√©e!${NC}"
    log_message "Le script s'ex√©cutera automatiquement tous les jours √† 2h du matin."
    log_message "Logs: $LOG_FILE"
}

# Fonction pour envoyer une alerte email (optionnel)
send_alert() {
    local zombie_count=$1
    if [ -n "$ALERT_EMAIL" ]; then
        echo "Alerte: $zombie_count processus zombies d√©tect√©s sur $(hostname) √† $(date)" | \
        mail -s "üö® Alerte Zombies sur $(hostname)" "$ALERT_EMAIL"
    fi
}

# Fonction d'aide
show_help() {
    echo "Usage: $0 [OPTION]"
    echo
    echo "Options:"
    echo "  --check        V√©rifier les processus zombies"
    echo "  --clean        Essayer de nettoyer les zombies"
    echo "  --install-cron Installer la v√©rification quotidienne automatique"
    echo "  --help         Afficher cette aide"
    echo
    echo "Exemples:"
    echo "  $0 --check              # V√©rifier les zombies"
    echo "  $0 --clean              # Nettoyer les zombies"
    echo "  sudo $0 --install-cron  # Installer la surveillance automatique"
}

# Point d'entr√©e principal
main() {
    # Cr√©er le fichier log si n√©cessaire
    touch "$LOG_FILE"
    
    case "$1" in
        --check)
            check_zombies
            exit $?
            ;;
        --clean)
            check_zombies
            if [ $? -gt 0 ]; then
                clean_zombies
            fi
            ;;
        --install-cron)
            install_cron_job
            ;;
        --help|-h)
            show_help
            ;;
        *)
            # Mode interactif par d√©faut
            echo -e "${YELLOW}=== Surveillance des processus zombies ===${NC}"
            check_zombies
            local result=$?
            
            if [ $result -gt 0 ]; then
                echo
                read -p "Voulez-vous essayer de nettoyer les zombies? (o/n): " -n 1 -r
                echo
                if [[ $REPLY =~ ^[Oo]$ ]]; then
                    clean_zombies
                fi
            fi
            ;;
    esac
}

# Lancer le script
main "$@"
```

## **Fichier de service systemd** (optionnel pour une meilleure int√©gration)

Cr√©ez `/etc/systemd/system/zombie-monitor.service` :

```ini
[Unit]
Description=Zombie Process Monitor
After=network.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/zombie_monitor.sh --check
User=root

[Install]
WantedBy=multi-user.target
```

Et `/etc/systemd/system/zombie-monitor.timer` :

```ini
[Unit]
Description=Daily Zombie Process Check

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
```

## **Installation et utilisation**

```bash
# 1. T√©l√©chargez le script
sudo nano /usr/local/bin/zombie_monitor.sh

# 2. Rendez-le ex√©cutable
sudo chmod +x /usr/local/bin/zombie_monitor.sh

# 3. Installez la v√©rification quotidienne
sudo zombie_monitor.sh --install-cron

# 4. Testez le script
sudo zombie_monitor.sh --check

# 5. Pour nettoyer manuellement
sudo zombie_monitor.sh --clean

# 6. V√©rifiez les logs
tail -f /var/log/zombie_monitor.log

# 7. V√©rifiez la t√¢che cron install√©e
crontab -l
```

## **Fonctionnalit√©s du script**

1. **V√©rification quotidienne automatique** via cron
2. **D√©tection et comptage** des processus zombies
3. **Nettoyage automatique** (envoi SIGCHLD aux parents)
4. **Journalisation compl√®te** dans `/var/log/zombie_monitor.log`
5. **Seuils d'alerte** configurables
6. **Interface en couleurs** pour une meilleure lisibilit√©
7. **Option de red√©marrage** si trop de zombies
8. **Support des alertes email** (optionnel)

Le script est s√©curis√© et n'effectue que des actions r√©versibles (il ne tue pas directement les zombies, mais envoie des signaux aux processus parents pour qu'ils nettoient leurs enfants).
